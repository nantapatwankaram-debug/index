<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Truck Inspection & Tracking</title>
<style>
html, body {
  margin:0;
  padding:0;
  height:100%;
  font-family: Arial,sans-serif;
  overflow:hidden;
}

/* ---------- Pages ---------- */
.page {
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  display:none;
  flex-direction:column;
  justify-content:flex-start;
  align-items:center;
  overflow-y:auto;
  padding:20px;
  box-sizing:border-box;
}

.page.active { display:flex; }

/* ---------- Navigation Buttons ---------- */
.nav-btns {
  margin-bottom:10px;
}
.nav-btns button {
  margin:0 5px;
  padding:6px 12px;
  border:none;
  border-radius:5px;
  background:#ffcc00;
  color:#333;
  font-weight:bold;
  cursor:pointer;
}
.nav-btns button:hover { background:#ffdd33; }

/* ---------- Start Screen ---------- */
#start-screen { 
  background: linear-gradient(135deg,#00c6ff,#0072ff); 
  color:#fff; 
  text-align:center; 
  justify-content:center; 
  display:flex; 
  flex-direction:column; 
  align-items:center; 
}
#start-screen img { width:120px; margin-bottom:20px; }
#start-screen h1 { font-size:2.5rem; margin-bottom:15px; }
#start-screen p { font-size:1.2rem; margin-bottom:30px; line-height:1.5; max-width:400px; }
#start-btn { font-size:20px; padding:15px 40px; border:none; border-radius:50px; background:#ffcc00; color:#333; font-weight:bold; cursor:pointer; box-shadow:0 5px 15px rgba(0,0,0,0.3); }
#start-btn:hover { background:#ffdd33; transform:translateY(-3px); }

/* ---------- Inspection Screen ---------- */
#inspection-screen { 
  width:100%; 
  color:#000; 
  background:#fff;
  overflow-y:auto; 
}
#inspection-screen h2 { color:#333; margin-bottom:15px; }
table { width:100%; border-collapse: collapse; margin-top: 10px; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background-color:#0066ff; color:#fff; }
input[type="text"], input[type="number"], input.remark { padding:5px 8px; border-radius:5px; border:1px solid #ccc; width:90%; }
.warning { color:red; font-weight:bold; margin-top:10px; }

/* ---------- Map Screen ---------- */
#map-screen { 
  width:100%; 
  height:100%; 
  flex-direction:column; 
  background:#fff;
}
#map { flex:1 1 auto; width:100%; border:1px solid #ccc; margin-bottom:10px; min-height:300px; }
#gps-table { width:100%; border-collapse: collapse; }
#gps-table th, #gps-table td { border:1px solid #ccc; padding:8px; text-align:center; }
#gps-table th { background-color:#0066ff; color:#fff; }

button { padding:8px 15px; border:none; border-radius:5px; background:#ffcc00; color:#333; font-weight:bold; cursor:pointer; }
button:hover { background:#ffdd33; }
</style>
</head>
<body>

<!-- ---------- Page 1: Start ---------- -->
<div id="start-screen" class="page active">
  <img src="https://cdn-icons-png.flaticon.com/512/3062/3062634.png" alt="Driver Icon">
  <h1>ระบบตรวจเช็ครถบรรทุก</h1>
  <p>กรอกข้อมูลรถบรรทุกก่อนออกเดินทาง ระบบจะแจ้งเตือนทันทีเมื่อพบสิ่งผิดปกติ</p>
  <button id="start-btn">เริ่มตรวจรถ</button>
</div>

<!-- ---------- Page 2: Inspection ---------- -->
<div id="inspection-screen" class="page">
  <div class="nav-btns">
    <button onclick="goPage('start-screen')">หน้า 1</button>
    <button onclick="goPage('inspection-screen')">หน้า 2</button>
    <button onclick="goPage('map-screen')">หน้า 3</button>
  </div>

  <h2>แบบฟอร์มตรวจเช็ครถบรรทุก</h2>
  <div style="margin-bottom:15px;">
    <label>ประเภทรถ: </label><input type="text" id="vehicleType">
    <label style="margin-left:10px;">ทะเบียนรถ: </label><input type="text" id="plateNumber"><br>
    <label>ชื่อ-สกุล พขร.: </label><input type="text" id="driverName">
    <label style="margin-left:10px;">พักผ่อนมาแล้ว (ชม.): </label><input type="number" id="restHours" min="0">
  </div>

  <table>
    <thead>
      <tr><th>รายการตรวจสอบ</th><th>ปกติ</th><th>ผิดปกติ</th><th>หมายเหตุ</th></tr>
    </thead>
    <tbody>
      <!-- 14 รายการครบตามที่คุณระบุ -->
      <tr><td>แบตเตอรี่</td><td><input type="checkbox" class="check" data-item="แบตเตอรี่" data-status="full"> เต็ม</td><td><input type="checkbox" class="check" data-item="แบตเตอรี่" data-status="low"> ต่ำ</td><td><input type="text" class="remark"></td></tr>
      <tr><td>สายพาน</td><td><input type="checkbox" class="check" data-item="สายพาน" data-status="good"> สภาพดี</td><td><input type="checkbox" class="check" data-item="สายพาน" data-status="bad"> ชำรุด/เสื่อมสภาพ</td><td><input type="text" class="remark"></td></tr>
      <tr><td>น้ำกลั่น</td><td><input type="checkbox" class="check" data-item="น้ำกลั่น" data-status="ok"> มีน้ำกลั่น</td><td><input type="checkbox" class="check" data-item="น้ำกลั่น" data-status="low"> ต่ำ/แห้ง</td><td><input type="text" class="remark"></td></tr>
      <tr><td>ระดับน้ำมันเครื่อง</td><td><input type="checkbox" class="check" data-item="น้ำมันเครื่อง" data-status="ok"> ตามเกณฑ์</td><td><input type="checkbox" class="check" data-item="น้ำมันเครื่อง" data-status="low"> ต่ำกว่าเกณฑ์</td><td><input type="text" class="remark"></td></tr>
      <tr><td>ระบบไฟ</td><td><input type="checkbox" class="check" data-item="ระบบไฟ" data-status="ok"> ไฟรอบคันใช้งานได้</td><td><input type="checkbox" class="check" data-item="ระบบไฟ" data-status="fault"> ไฟหน้า/ไฟท้ายเสีย</td><td><input type="text" class="remark"></td></tr>
      <tr><td>ยางรถ</td><td><input type="checkbox" class="check" data-item="ยางรถ" data-status="good"> สภาพดี / มีอะไหล่</td><td><input type="checkbox" class="check" data-item="ยางรถ" data-status="bad"> เสื่อมสภาพ</td><td><input type="text" class="remark"></td></tr>
      <tr><td>หมอนรองล้อ และ สายรัดกรง</td><td><input type="checkbox" class="check" data-item="หมอน/สายรัด" data-status="ok"> มีหมอนรองล้อ / สายรัดกรง</td><td><input type="checkbox" class="check" data-item="หมอน/สายรัด" data-status="none"> ไม่มีทั้งคู่</td><td><input type="text" class="remark"></td></tr>
      <tr><td>การทำงานลิฟต์-รีโมท</td><td><input type="checkbox" class="check" data-item="ลิฟต์-รีโมท" data-status="ok"> ทำงานปกติ</td><td><input type="checkbox" class="check" data-item="ลิฟต์-รีโมท" data-status="fault"> รีโมทใช้งานไม่ได้</td><td><input type="text" class="remark"></td></tr>
      <tr><td>การรั่วซึมของกระบอกลิฟต์</td><td><input type="checkbox" class="check" data-item="กระบอกลิฟต์" data-status="ok"> ไม่รั่วซึม</td><td><input type="checkbox" class="check" data-item="กระบอกลิฟต์" data-status="fault"> รั่ว / มีเสียงผิดปกติ</td><td><input type="text" class="remark"></td></tr>
      <tr><td>ไฮดรอลิคลิฟต์</td><td><input type="checkbox" class="check" data-item="ไฮดรอลิคลิฟต์" data-status="ok"> ไม่รั่วซึม / ปกติ</td><td><input type="checkbox" class="check" data-item="ไฮดรอลิคลิฟต์" data-status="fault"> รั่ว / เสียงผิดปกติ</td><td><input type="text" class="remark"></td></tr>
    </tbody>
  </table>

  <p id="alert-msg" class="warning"></p>
  <button id="to-map">ต่อไป: แผนที่</button>
</div>

<!-- ---------- Page 3: Map & GPS ---------- -->
<div id="map-screen" class="page">
  <div class="nav-btns">
    <button onclick="goPage('start-screen')">หน้า 1</button>
    <button onclick="goPage('inspection-screen')">หน้า 2</button>
    <button onclick="goPage('map-screen')">หน้า 3</button>
  </div>

  <h2>GPS Update / แผนที่</h2>
  <div id="map"></div>
  <table id="gps-table">
    <thead><tr><th>รถ</th><th>ตำแหน่งล่าสุด</th><th>เวลา</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<script>
// ---------- Page Navigation ----------
function goPage(id){
  document.querySelector(".page.active").classList.remove("active");
  document.getElementById(id).classList.add("active");
  if(id==='map-screen') initMap();
}

document.getElementById("start-btn").onclick = ()=>{ goPage('inspection-screen'); }
document.getElementById("to-map").onclick = ()=>{ goPage('map-screen'); }

// ---------- Real-time Inspection ----------
function playAlertSound(){ const audio=new Audio("https://www.soundjay.com/buttons/sounds/beep-07a.mp3"); audio.play(); }
function checkRealtime(item,status){
  const alertMsg=document.getElementById("alert-msg");
  if(status!=="ok" && status!=="full" && status!=="good"){ alertMsg.innerText=`⚠ ${item} ผิดปกติ!`; playAlertSound(); }
  else alertMsg.innerText="";
}
document.querySelectorAll('.check').forEach(cb=>{
  cb.addEventListener('change',function(){
    const item=cb.getAttribute('data-item');
    const status=cb.getAttribute('data-status');
    document.querySelectorAll(`.check[data-item="${item}"]`).forEach(s=>{ if(s!==cb) s.checked=false; });
    checkRealtime(item,status);
  });
});

// ---------- Map & GPS ----------
let map,directionsService,directionsRenderer;
const trucks=[
  {id:"Truck1",lat:13.7350,lng:100.5350,alerted:false},
  {id:"Truck2",lat:13.7400,lng:100.5450,alerted:false},
  {id:"Truck3",lat:13.7450,lng:100.5500,alerted:false}
];
const waypoints=[{location:{lat:13.7420,lng:100.5400},name:"จุดหมาย 1"},{location:{lat:13.7480,lng:100.5500},name:"จุดหมาย 2"}];

function initMap(){
  if(map) return;
  map=new google.maps.Map(document.getElementById("map"),{center:{lat:13.7367,lng:100.5232},zoom:13});
  directionsService=new google.maps.DirectionsService();
  directionsRenderer=new google.maps.DirectionsRenderer({map:map});

  trucks.forEach(truck=>{
    truck.marker=new google.maps.Marker({position:{lat:truck.lat,lng:truck.lng},map:map,title:truck.id});
  });

  updateGPSTable();
  setInterval(updateTruckPosition,5000);
}

function updateGPSTable(){
  const tbody=document.querySelector("#gps-table tbody");
  tbody.innerHTML="";
  trucks.forEach(truck=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td><button onclick="focusTruck('${truck.id}')">${truck.id}</button></td>
                  <td>${truck.lat.toFixed(5)}, ${truck.lng.toFixed(5)}</td>
                  <td>${new Date().toLocaleTimeString()}</td>`;
    tbody.appendChild(tr);
  });
}

function focusTruck(id){
  const truck=trucks.find(t=>t.id===id);
  if(truck){
    map.setCenter({lat:truck.lat,lng:truck.lng});
    map.setZoom(16);
    calculateRoute({lat:truck.lat,lng:truck.lng});
  }
}

function calculateRoute(origin){
  const wp=waypoints.map(p=>({location:p.location,stopover:true}));
  directionsService.route({
    origin:origin,
    destination:waypoints[waypoints.length-1].location,
    waypoints:wp,
    travelMode:google.maps.TravelMode.DRIVING,
    optimizeWaypoints:false
  },(response,status)=>{
    if(status===google.maps.DirectionsStatus.OK){
      directionsRenderer.setDirections(response);
    }else console.error("Directions request failed due to "+status);
  });
}

function updateTruckPosition(){
  trucks.forEach(truck=>{
    truck.lat += (Math.random()-0.5)*0.001;
    truck.lng += (Math.random()-0.5)*0.001;
    truck.marker.setPosition({lat:truck.lat,lng:truck.lng});
    checkProximity(truck);
  });
  updateGPSTable();
}

function checkProximity(truck){
  waypoints.forEach(point=>{
    if(!truck.alerted){
      const d=getDistance({lat:truck.lat,lng:truck.lng},point.location);
      if(d<100){ alert(`ใกล้ถึง ${point.name} ของ ${truck.id} แล้ว!`); playAlertSound(); truck.alerted=true; }
    }
  });
}

function getDistance(pos1,pos2){
  const R=6371e3,φ1=pos1.lat*Math.PI/180,φ2=pos2.lat*Math.PI/180;
  const Δφ=(pos2.lat-pos1.lat)*Math.PI/180,Δλ=(pos2.lng-pos1.lng)*Math.PI/180;
  const a=Math.sin(Δφ/2)**2+Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
</body>
</html>
